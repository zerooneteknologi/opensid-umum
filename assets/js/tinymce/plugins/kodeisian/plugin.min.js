tinymce.PluginManager.add('kodeisian', function (editor, url) {
    editor.ui.registry.addMenuButton('kodeisian', {
        text: 'Kode Isian',
        fetch: function (callback) {
            var items = [];

            $.ajax({
                type: "GET",
                url: SITE_URL + "surat_master/kode_isian/" + $('#id_surat').val(),
                dataType: "json",
                processData: true,
                success: function (response) {
                    $.each(response, function (key, value) {
                        var menuItem = {
                            type: 'nestedmenuitem',
                            text: key,
                            getSubmenuItems: function () {
                                return kode_isian(editor, value);
                            }
                        };
                        items.push(menuItem);
                    });

                    callback(items);
                },

                error: function (xhr, status, error) {
                    alert("Error! " + xhr.status + "\n" + error);
                    console.log(xhr);
                }
            });
        },
    });

});

function kode_isian(editor, isian) {
    var kode_isian = [];

    $.each(isian, function (key, value) {
        var combine = {
            type: 'menuitem',
            text: value.judul,
            onAction: function () {
                editor.insertContent(value.isian);
            }
        }
        kode_isian.push(combine);
    });

    return kode_isian;
}